scale_x_continuous(labels = scales::dollar_format(scale = 1e-6, suffix = "M")) +
labs(
title = str_glue("Top {n} Customers"),
subtitle = str_glue("Start: {year(min(order_lines_tbl$order_purchase_timestamp))}
End:  {year(max(order_lines_tbl$order_purchase_timestamp))}"),
x = "Revenue ($M)",
y = "Customer",
caption = str_glue("Top 3 cities contribute
24% of purchasing power.")
) +
theme_minimal() +
theme(
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
# Data Manipulation
pct_sales_by_customer_tbl <- bike_orderlines_tbl %>%
select(bikeshop_name, category_1, category_2, quantity) %>%
group_by(bikeshop_name, category_1, category_2) %>%
summarise(total_qty = sum(quantity)) %>%
ungroup() %>%
group_by(bikeshop_name) %>%
mutate(pct = total_qty / sum(total_qty)) %>%
ungroup() %>%
mutate(bikeshop_name = as.factor(bikeshop_name) %>% fct_rev()) %>%
mutate(bikeshop_name_num = as.numeric(bikeshop_name))
# Data Visualization
pct_sales_by_customer_tbl %>%
ggplot(aes(category_2, bikeshop_name)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ category_1, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
products_tbl    <- read_csv(file = "00_data/01_e-commerce/01_raw_data/olist_products_dataset.csv")
products_tbl
products_tbl %>% set_names(names(.) %>% str_replace_all("\\.", "_"))
products_tbl %>% set_names(names(.) %>% str_replace_all("\\.", "_")) %>%
separate(col    = product.category.name,
into   = c("main.category.name", "sub.category.name"),
sep    = " - ",
remove = FALSE) %>%
products_tbl %>% set_names(names(.) %>% str_replace_all("\\.", "_")) %>%
separate(col    = product.category.name,
into   = c("main.category.name", "sub.category.name"),
sep    = " - ",
remove = FALSE)
products_tbl %>% set_names(names(.) %>% str_replace_all("\\.", "_")) %>%
separate(col    = product_category_name,
into   = c("main_category_name", "sub_category_name"),
sep    = " - ",
remove = FALSE)
products_tbl <- products_tbl %>% set_names(names(.) %>% str_replace_all("\\.", "_")) %>%
separate(col    = product_category_name,
into   = c("main_category_name", "sub_category_name"),
sep    = " - ",
remove = FALSE)
products_tbl
products_tbl %>% saveRDS("00_data/01_e-commerce/02_wrangled_data/products_tbl.rds")
products_tbl %>% unique(main_category_name)
products_tbl %>% pull(main_category_name) %>% unique()
products_tbl %>% select(main_category_name, sub_category_name) %>% unique()
products_tbl %>% select(main_category_name, sub_category_name) %>% unique() %>% print(n=70)
products_tbl %>% select(main_category_name, sub_category_name) %>% unique() %>% arrange(main_category_name) %>% print(n=70)
# Data Visualization
pct_sales_by_customer_tbl %>%
ggplot(aes(category_2, bikeshop_name)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ category_1, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
products_tbl %>% select(main_category_name, sub_category_name) %>% unique() %>% arrange(main_category_name) %>% print(n=70)
products_tbl
order_lines_tbl
order_lines_tbl <- order_items_tbl %>%
left_join(orders_tbl) %>%
left_join(customers_tbl) %>%
left_join(products_tbl)
order_lines_tbl
order_lines_tbl <- order_items_tbl %>%
left_join(orders_tbl) %>%
left_join(customers_tbl) %>%
left_join(products_tbl)
order_lines_tbl %>% filter(main_category_name == "fashion" | main_category_name == "moveis")
order_lines_tbl %>% select(main_category_name, order_id, order_item_id)
order_lines_tbl %>% select(main_category_name, order_id, order_item_id) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis")
order_lines_tbl %>% select(main_category_name, sub_category_name) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis")
order_lines_tbl %>% select(main_category_name, sub_category_name, customer_city) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis")
order_lines_tbl %>% select(main_category_name, sub_category_name, customer_city, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis")
order_lines_tbl %>%
select(customer_city, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_city, main_category_name, sub_category_name)
order_lines_tbl %>%
select(customer_city, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_city, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup()
order_lines_tbl %>%
select(customer_city, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_city, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_city) %>%
mutate(pct = total_revenue / sum(total_revenue)) %>%
ungroup() %>%
mutate(customer_city = as.factor(customer_city) %>% fct_rev()) %>%
mutate(customer_city_num = as.numeric(customer_city))
# Data Manipulation
pct_sales_by_customer_tbl <- bike_orderlines_tbl %>%
select(bikeshop_name, category_1, category_2, quantity) %>%
group_by(bikeshop_name, category_1, category_2) %>%
summarise(total_qty = sum(quantity)) %>%
ungroup() %>%
group_by(bikeshop_name) %>%
mutate(pct = total_qty / sum(total_qty)) %>%
ungroup() %>%
mutate(bikeshop_name = as.factor(bikeshop_name) %>% fct_rev()) %>%
mutate(bikeshop_name_num = as.numeric(bikeshop_name))
pct_sales_by_customer_tbl
order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = total_revenue / sum(total_revenue)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
bike_orderlines_tbl
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = total_revenue / sum(total_revenue)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = total_revenue / sum(total_revenue) %>% round(digits = 4)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = total_revenue / sum(total_revenue) %>% round(digits = 2)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = round((total_revenue / sum(total_revenue)), digits = 2)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
pct_sales_by_state_tbl
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = round((total_revenue / sum(total_revenue)), digits = 4)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = round((total_revenue / sum(total_revenue)), digits = 1)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
pct_sales_by_state_tbl <- order_lines_tbl %>%
select(customer_state, main_category_name, sub_category_name, price) %>%
filter(main_category_name == "fashion" | main_category_name == "moveis") %>%
group_by(customer_state, main_category_name, sub_category_name) %>%
summarise(total_revenue = sum(price)) %>%
ungroup() %>%
group_by(customer_state) %>%
mutate(pct = round((total_revenue / sum(total_revenue)), digits = 2)) %>%
ungroup() %>%
mutate(customer_state = as.factor(customer_state) %>% fct_rev()) %>%
mutate(customer_state_num = as.numeric(customer_state))
# Data Visualization
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
install.packages("maps")
install.packages("sf")
library(sf)
ggplot() +
geom_sf(data=states, fill="#2D3E50", color="#FEBF57", size=.15, show.legend = FALSE)
states <- read_state(year=2014)
install.packages("geobr")
library(geobr)
states <- read_state(year=2014)
ggplot() +
geom_sf(data=states, fill="#2D3E50", color="#FEBF57", size=.15, show.legend = FALSE)
pct_sales_by_state_tbl %>%
ggplot(aes(sub_category_name, customer_state)) +
# Geometries
geom_tile(aes(fill = pct)) +
geom_text(aes(label = scales::percent(pct)),
size = 3) +
facet_wrap(~ main_category_name, scales = "free_x") +
# Formatting
scale_fill_gradient(low = "white", high = palette_light()[1]) +
labs(
title = "Heatmap of Purchasing Habits",
x = "Bike Type (Category 2)",
y = "Customer",
caption = str_glue(
"Customers that prefer Road:
Ann Arbor Speed, Austin Cruisers, & Indianapolis Velocipedes
Customers that prefer Mountain:
Ithaca Mountain Climbers, Pittsburgh Mountain Machines, & Tampa 29ers")
) +
theme_tq() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.caption = element_text(face = "bold.italic")
)
blogdown::serve_site()
